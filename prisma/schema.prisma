generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id               String     @id @default(cuid())
  name             String?
  email            String     @unique
  password         String?
  roles            UserRole[]
  festivals        Festival[]
  orisas           Orisa[]
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  // accounts  Account[]
  twoFactorEnabled Boolean    @default(false)
  // Session          Session[]
  // Account          Account[]
  accounts         Account[]
  sessions         Session[]
  emailVerified    Boolean    @default(false)
  image            String?

  // @@unique([email])
  @@map("user")
}

model Role {
  id    String     @id @default(cuid())
  name  String     @unique
  users UserRole[]
}

model UserRole {
  id       String    @id @default(cuid())
  user     User      @relation(fields: [userId], references: [id])
  userId   String
  role     Role      @relation(fields: [roleId], references: [id])
  roleId   String
  sessions Session[]
  accounts Account[]

  @@unique([userId, roleId])
  @@map("user_roles")
}

model Orisa {
  id        Int        @id @default(autoincrement())
  name      String     @unique
  userId    String?
  user      User?      @relation(fields: [userId], references: [id])
  festivals Festival[]
}

model Festival {
  id         Int      @id @default(autoincrement())
  title      String
  startYear  Int
  startMonth Int
  startDay   Int
  endYear    Int
  endMonth   Int
  endDay     Int
  location   String
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  orisa      Orisa    @relation(fields: [orisaId], references: [id])
  orisaId    Int
  createdAt  DateTime @default(now())
}

// model Account {
//   id                Int     @id @default(autoincrement())
//   userId            String
//   type              String
//   provider          String
//   providerAccountId String
//   refresh_token     String?
//   access_token      String?
//   expires_at        Int?
//   token_type        String?
//   scope             String?
//   id_token          String?
//   session_state     String?

//   user User @relation(fields: [userId], references: [id])

//   @@unique([provider, providerAccountId])
// }

// model Session {
//   id         String    @id @default(cuid())
//   expiresAt  DateTime
//   token      String    @unique
//   ipAddress  String?
//   userAgent  String?
//   userId     String
//   user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
//   createdAt  DateTime  @default(now())
//   updatedAt  DateTime  @updatedAt
//   userRole   UserRole? @relation(fields: [userRoleId], references: [id])
//   userRoleId String?

//   @@map("session")
// }

// model Account {
//   id           String    @id @default(cuid())
//   accountId    String
//   providerId   String
//   userId       String
//   user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
//   accessToken  String?
//   refreshToken String?
//   idToken      String?
//   expiresAt    DateTime?
//   password     String?
//   createdAt    DateTime  @default(now())
//   updatedAt    DateTime  @updatedAt

//   accessTokenExpiresAt  DateTime?
//   refreshTokenExpiresAt DateTime?
//   scope                 String?
//   userRole              UserRole? @relation(fields: [userRoleId], references: [id])
//   userRoleId            String?

//   @@map("account")
// }

// model Verification {
//   id         String    @id @default(cuid())
//   identifier String
//   value      String
//   expiresAt  DateTime
//   createdAt  DateTime? @default(now())
//   updatedAt  DateTime? @updatedAt

//   @@map("verification")
// }

model Account {
  id                 String    @id @default(cuid())
  userId             String
  providerType       String
  providerId         String
  providerAccountId  String
  refreshToken       String?
  accessToken        String?
  accessTokenExpires DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  user               User      @relation(fields: [userId], references: [id])
  userRole           UserRole? @relation(fields: [userRoleId], references: [id])
  userRoleId         String?

  @@unique([providerId, providerAccountId])
}

model Session {
  id           String    @id @default(cuid())
  userId       String
  expires      DateTime
  sessionToken String    @unique
  accessToken  String    @unique
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id])
  userRole     UserRole? @relation(fields: [userRoleId], references: [id])
  userRoleId   String?
}

model VerificationRequest {
  id         String   @id @default(cuid())
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, token])
}
